{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="{% static 'CSS/Navbar.css' %}">
  <link rel="stylesheet" href="{% static 'CSS/Usuario/Inicio_sesion.css' %}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  <script src="https://kit.fontawesome.com/6a284d15f6.js" crossorigin="anonymous"></script>
  <link rel="icon" type="image/x-icon" class="fa-solid fa-shield-halved">
  <title>Inicio de Sesi√≥n</title>
</head>

<body>

  <nav id="navbar" class="navbar">

    <!-- Bot√≥n del men√∫ desplegable -->
    <div class="dropdown">
      <i id="boton-opciones" role="button" class="fa-solid fa-bars dropdown-toggle" onclick="toggleDropdown()">
        <div class="dropdown-menu" id="dropdownMenu">
          <a href="{% url 'index' %}" class="dropdown-item">
            <i class="fa-solid fa-map"></i> Mapa
          </a>
          <a href="" class="dropdown-item">
            <i class="fa-solid fa-list"></i> Historial de Alertas
          </a>
          <a href="" class="dropdown-item">
            <i class="fa-solid fa-chart-pie"></i> Graficos
          </a>
        </div>
      </i>
    </div>

    <h2 class="titulo-pagina">Rutas Seguridad Ciudadana "San Bernardo"</h2>

    <!-- Bot√≥n del men√∫ Usuario -->
    <div class="dropdown2">
      <i id="boton-usuario" role="button" class="fa-solid fa-user dropdown-toggle2" onclick="toggleDropdown2()">
        <div class="dropdown-menu2" id="dropdownUsuario">
          <a href="{% url 'login' %}" class="dropdown-item2">
            <i class="fa-solid fa-right-to-bracket"></i> Iniciar Sesi√≥n
          </a>
          <a href="" class="dropdown-item2">
            <i class="fa-solid fa-list"></i> Historial de Alertas
          </a>
        </div>
      </i>
    </div>

  </nav>

  <!-- Bloque con el formulario de inicio de sesion -->
  <div class="login-container">
    <div class="login-header">
      <h1>üîê Inicio de Sesi√≥n</h1>
      <p>Sistema de Seguridad Ciudadana - Personal Autorizado</p>
    </div>

    <form id="login-form" method="POST" action="{% url 'login' %}">
      {% csrf_token %}
      <div class="form-group">
        <label>üìß Correo Electr√≥nico</label>
        <input type="email" name="correo_electronico_usuario" required placeholder="usuario@seguridad.cl"
          value="{{ request.POST.correo_electronico_usuario|default:'' }}" id="email-input">
      </div>

      <div class="form-group">
        <label>üîí Contrase√±a</label>
        <input type="password" name="password" required placeholder="Ingrese su contrase√±a" id="password-input">
      </div>

      <button type="submit" id="submit-btn">üöÄ Iniciar Sesi√≥n</button>
    </form>

    <div class="login-footer">
      <p><strong>Acceso restringido:</strong> Solo para Administradores y Operadores de la municipalidad de San Bernardo.</p>
    </div>

  </div>

  <!-- Ejecuci√≥n de Scripts -->
  <script src="{% static 'JavaScript/Mapa.js' %}"></script>
  <script src="{% static 'JavaScript/Redirecciones.js' %}"></script>

  <!-- Script para SweetAlert -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // ‚úÖ SOLO MOSTRAR ERRORES EN LOGIN, NO BIENVENIDAS
      {% if alert_type %}
      const alertType = '{{ alert_type|escapejs }}';
      const alertTitle = '{{ alert_title|escapejs }}';
      const alertMessage = '{{ alert_message|escapejs }}';

      Swal.fire({
        icon: alertType,
        title: alertTitle,
        text: alertMessage,
        confirmButtonText: 'Aceptar',
        confirmButtonColor: alertType === 'success' ? '#28a745' : '#dc3545',
        background: '#1e1e1e',
        color: 'white',
        timer: 5000,
        timerProgressBar: true
      });
      {% endif %}

      // Validaci√≥n del formulario
      if (loginForm) {
        loginForm.addEventListener('submit', function (e) {
          const email = document.getElementById('email-input').value;
          const password = document.getElementById('password-input').value;

          // Validaci√≥n b√°sica
          if (!email || !password) {
            e.preventDefault();
            Swal.fire({
              icon: 'warning',
              title: 'Campos incompletos ‚ö†Ô∏è',
              text: 'Por favor complete todos los campos',
              confirmButtonText: 'Entendido',
              confirmButtonColor: '#ffc107',
              background: '#1e1e1e',
              color: 'white'
            });
            return;
          }

          // Mostrar loading
          submitBtn.innerHTML = '‚è≥ Validando credenciales...';
          submitBtn.disabled = true;
        });
      }
    });
  </script>
</body>

</html>